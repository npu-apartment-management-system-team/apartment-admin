import{r as c,j as e,R as me}from"./react-2ce75adb.js";import{c as Pe}from"./react-dom-16e2f971.js";import{B as Ee}from"./react-router-dom-93ff5a9d.js";import{a as se}from"./axios-4a70c6fc.js";import{q as Oe}from"./qs-88f287ae.js";import{J as Le}from"./js-encrypt-af0330d8.js";import{I as D,T as ge,B as A,M as Te,S as fe,a as z,b as Be,L as pe,c as De,H as Ne,C as Me,D as H,R as M}from"./antd-8ba4bffd.js";import{U as xe,r as ze,s as ae,i as oe,t as R}from"./@ant-design-ed38ce50.js";import{u as he,a as je,b as T,N as ye}from"./react-router-e1c202a2.js";import{P as B}from"./pubsub-js-164616ad.js";import{v as Q}from"./uuid-a960c1f4.js";import{s as te}from"./store-502a59ff.js";import"./call-bind-892c8155.js";import"./get-intrinsic-bd2830fd.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-f7d0b240.js";import"./function-bind-22e7ee79.js";import"./has-26d28e02.js";import"./scheduler-765c72db.js";import"./@remix-run-93d98c9a.js";import"./side-channel-b75e8576.js";import"./object-inspect-13342da8.js";import"./rc-util-6113d818.js";import"./@babel-5495bcd4.js";import"./react-is-e8e5dbb3.js";import"./classnames-776d2d10.js";import"./rc-resize-observer-a555e72e.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-motion-03bbea80.js";import"./rc-menu-c9d15123.js";import"./rc-overflow-9ca771c7.js";import"./@rc-component-a9ea3bc3.js";import"./rc-select-92a0ff80.js";import"./rc-virtual-list-defe1c81.js";import"./rc-drawer-651537b2.js";import"./rc-field-form-57489eb5.js";import"./async-validator-7f96df71.js";import"./rc-table-c1c02ffb.js";import"./rc-pagination-00abd4cf.js";import"./rc-picker-f2201c79.js";import"./@ctrl-fb5a5473.js";import"./throttle-debounce-87e7e444.js";import"./rc-checkbox-40fd5abe.js";import"./rc-dropdown-28db7cec.js";import"./rc-tooltip-97af0835.js";import"./rc-tree-4abb3b64.js";import"./rc-input-dbde50a4.js";import"./rc-textarea-47b9c3f4.js";import"./@emotion-c0b5c018.js";import"./stylis-fad5b415.js";(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))x(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const j of u.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&x(j)}).observe(document,{childList:!0,subtree:!0});function f(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function x(o){if(o.ep)return;o.ep=!0;const u=f(o);fetch(o.href,u)}})();const E=se.create({baseURL:"https://apartment-server.wangminan.me",paramsSerializer:n=>Oe.stringify(n,{arrayFormat:"brackets"})});E.interceptors.request.use(n=>(window.localStorage.getItem("token")!==void 0&&(n.headers.Authorization="Bearer "+window.localStorage.getItem("token")),n),n=>Promise.reject(n));E.interceptors.response.use(n=>(n!==null&&n.data!==null&&n.data.code!==null&&(n.data.code===4012||n.data.code===4010||n.data.code===4030)&&(window.localStorage.removeItem("token"),setTimeout(()=>{window.location.href="/login"},3e3)),n),n=>Promise.reject(n));const qe=`MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5vwYRBKySNSl/60qRqcD
lDVcNP9j2UyB7yalGI9MtlBEZ16pEiR08TuZjUL00go5LEb6z+ghVlp6UOsWR6i3
r7Q+FleKHG2yStqqaWx+11OQzOjffXQwqb1t/0bq/tzy04KBinSaB/yqnMc0yO8n
rZx8OtUX5rMcM7BjvpFOdnCSFUAOOfKRirfT5RydyGeLPOnBTwJIwpygGu20++UX
MxARO1aAJeUXeI+9g+XcsAi1EKbI2YdjWJ8PQnBC9+lsDRS3w8uKqUOZdYu/FxAy
bEjQ+YOXzfu2PB9+BdilkztV/yuF6hfk7MpGdA2JoBsJlljSYWH1mUE+e9mnUyHi
/wIDAQAB`;function Ke(n){const g=new Le;return g.setPublicKey(qe),g.encrypt(n)}function He(n){const g="13777864433",f="root",[x,o]=c.useState(g),[u,j]=c.useState(f),[y,k]=c.useState(!1);function w(b){o(()=>b.target.value)}function I(b){j(()=>b.target.value)}function h(){k(!0),E({method:"POST",url:"/api/auth/login/password",data:{username:x,password:Ke(u)}}).then(b=>{const{code:m,result:p}=b.data;if(m===2e3)if(window.localStorage.setItem("token",p.token),window.localStorage.setItem("role",p.role),p.user)p.user,n.login(p.role,p.user);else{const S=p.admin;window.localStorage.setItem("user.id",S.id),window.localStorage.setItem("user.name",S.name),window.localStorage.setItem("user.loginAccountId",S.loginAccountId),window.localStorage.setItem("user.email",S.email),n.login(p.role,p.admin)}else{const{msg:S}=b.data;j(""),alert(S)}k(!1)})}return e.jsxs("div",{children:[e.jsx(D,{value:x,onChange:w,placeholder:"Enter your username",prefix:e.jsx(xe,{className:"site-form-item-icon"}),suffix:e.jsx(ge,{title:"Extra information",children:e.jsx(ze,{style:{color:"rgba(0,0,0,.45)"}})})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(D.Password,{value:u,onChange:I,placeholder:"input password",iconRender:b=>b?e.jsx(ae,{}):e.jsx(oe,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(A,{size:"large",type:"primary",loading:y,onClick:h,children:"Login"})]})}function Qe(){const[n,g]=c.useState(""),[f,x]=c.useState(""),[o,u]=c.useState(""),[j,y]=c.useState("");function k(m){g(()=>m.target.value)}function w(m,p){y(p!==""&&m!==p?()=>"error":()=>"")}function I(m){x(()=>m.target.value),w(m.target.value,o)}function h(m){u(()=>m.target.value),w(f,m.target.value)}function b(m){f!==o&&alert("")}return e.jsxs("div",{children:[e.jsx(D,{onChange:k,placeholder:"default size",prefix:e.jsx(xe,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(D.Password,{onChange:I,placeholder:"input password",iconRender:m=>m?e.jsx(ae,{}):e.jsx(oe,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(D.Password,{status:j,onChange:h,placeholder:"password again",iconRender:m=>m?e.jsx(ae,{}):e.jsx(oe,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(A,{size:"large",type:"primary",onClick:b,children:"SignUP"})]})}const Ge=""+new URL("apartment-d819f74c.svg",import.meta.url).href;function $e(n){const{routers:g}=n,f=he();function x(o){f("/home"+g[parseInt(o.key,10)-1].route,{replace:!0})}return e.jsx("div",{children:e.jsx("div",{children:e.jsx(Te,{mode:n.mode,theme:n.theme,items:n.textitem,onClick:x})})})}function Je(n){return e.jsx(ge,{placement:"right",title:"先生/女士",children:e.jsxs("span",{children:["欢迎您，",n.job," ",n.usermsg]})})}function re(n){const{getApart:g,getRoom:f,getBed:x}=n;let{tabletype:o,columns:u,tabledata:j,tablepage:y,tabletitle:k}=n;const[w,I]=c.useState(!1);B.subscribe("tablereturned",(m,p)=>{I(()=>p),console.log(w)});const[,h]=me.useState(),b=me.useCallback(()=>h({}),[]);return c.useEffect(()=>{o==="apart"?(I(!1),g(1,100),b()):o==="room"?(I(!1),f(1,100),b()):o==="bed"&&(I(!1),x(1,100))},[o]),w?(B.subscribe("tablepage",(m,p)=>{y=p,console.log(y)}),e.jsx("div",{children:e.jsxs(z,{direction:"vertical",size:16,children:[e.jsx("h2",{children:k}),e.jsx(A,{tabletype:o,children:"增加"}),e.jsx(Be,{columns:u,dataSource:j,pagination:!1})]})})):e.jsx("div",{children:e.jsx(fe,{})})}const _e={textAlign:"center",minHeight:120,lineHeight:"120px",color:"#000",backgroundColor:"#eee"},Xe={textAlign:"center",lineHeight:"120px"};function Ye(n){const{logOut:g}=n,{getApart:f,getRoom:x,getBed:o}=n,{lognum:u,textitem:j,usermsg:y,columns:k,tabledata:w,tablepage:I,tabletitle:h}=n,b=j[u].routers,[m,p]=c.useState(!1);function S(){g()}return e.jsx(z,{direction:"vertical",style:{width:"100%"},size:[0,48],children:e.jsxs(pe,{style:{minHeight:"100vh"},children:[e.jsx(De,{style:Xe,collapsible:!0,collapsed:m,onCollapse:N=>p(N),children:e.jsx($e,{mode:"inline",theme:"dark",textitem:j[u].item,routers:b})}),e.jsxs(pe,{children:[e.jsx(Ne,{children:e.jsx(A,{onClick:S,children:"LogOut"})}),e.jsx(Me,{style:_e,children:e.jsxs(je,{children:[e.jsx(T,{path:"/home/welcome",element:e.jsx(Je,{job:j[u].name,usermsg:y})}),e.jsx(T,{path:"/home/apart",element:e.jsx(re,{getApart:f,tabletype:"apart",columns:k,tabledata:w,tablepage:I,tabletitle:h})}),e.jsx(T,{path:"/home/room",element:e.jsx(re,{getRoom:x,tabletype:"room",columns:k,tabledata:w,tablepage:I,tabletitle:h})}),e.jsx(T,{path:"/home/bed",element:e.jsx(re,{getBed:o,tabletype:"bed",columns:k,tabledata:w,tablepage:I,tabletitle:h})}),e.jsx(T,{path:"*",element:e.jsx(ye,{to:"/home/welcome"})})]})})]})]})})}function Ve(n){const{type:g,title:f,placement:x,onClose:o,open:u,tableitems:j,records:y,apartUpdate:k,roomUpdate:w}=n,[I,h]=c.useState(!1),[b,m]=c.useState(0),[p,S]=c.useState({status:0});function N(){h(!0),k(y.index,p),h(!1)}function G(J){S(()=>(p.status=J.target.value,p)),m(J.target.value)}function $(){h(!0),console.log(y),w(y.index,p),h(!1)}function q(){h(!0),console.log(y),w(y.index,p),h(!1)}if(j.length===0)return e.jsx(H,{title:f,placement:x,onClose:o,open:u,children:e.jsx(fe,{})});if(g==="apart")return e.jsxs(H,{title:f,placement:x,onClose:o,open:u,children:[j,"此公寓",e.jsxs(M.Group,{onChange:G,value:b,children:[e.jsx(M,{value:0,children:"正常使用"}),e.jsx(M,{value:1,children:"启用中"}),e.jsx(M,{value:2,children:"弃用中"}),e.jsx(M,{value:3,children:"已弃用"})]}),e.jsx("br",{}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{type:"primary",loading:I,onClick:N,children:"修改"})})]});if(g==="room")return e.jsxs(H,{title:f,placement:x,onClose:o,open:u,children:[j,e.jsx("br",{}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{type:"primary",loading:I,onClick:$,children:"修改"})})]});if(g==="bed")return e.jsxs(H,{title:f,placement:x,onClose:o,open:u,children:[j,e.jsx("br",{}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{type:"primary",loading:I,onClick:q,children:"修改"})})]})}function U(n,g,f,x,o){return{key:g,icon:f,children:x,label:n,type:o}}const We=[{},{id:1,name:"超级管理员",item:[U("管理员账号管理","1",e.jsx(R,{})),U("外部单位管理","2",e.jsx(R,{})),U("公寓管理","3",e.jsx(R,{})),U("房间管理","4",e.jsx(R,{}))]},{id:2,name:"入住办理员",item:[U("入住申请审核","1",e.jsx(R,{})),U("床位编号录入","2",e.jsx(R,{})),U("人脸录入确认","3",e.jsx(R,{}))]},{id:3,name:"宿舍调配员",item:[U("住/调宿申请","1",e.jsx(R,{})),U("公寓管理","2",e.jsx(R,{})),U("房间管理","3",e.jsx(R,{})),U("床位管理","4",e.jsx(R,{}))],routers:[{route:"/promise"},{route:"/apart"},{route:"/room"},{route:"/bed"}]},{id:4,name:"财务人员",item:[U("缴费统计表","1",e.jsx(R,{})),U("催收信","2",e.jsx(R,{})),U("宿舍情况查询","3",e.jsx(R,{}))]}];function Ze(){const[n,g]=c.useState(!1),[f,x]=c.useState(0),[o,u]=c.useState(null),[j,y]=c.useState([]),[k,w]=c.useState([]),[I,h]=c.useState(0),[b,m]=c.useState(""),[p,S]=c.useState(!1),[N,G]=c.useState(""),[$,q]=c.useState({}),[J,_]=c.useState([]),[be,we]=c.useState([]),[F,K]=c.useState({}),[X,O]=c.useState([]),[Ie,Se]=c.useState(""),[tt,Y]=c.useState(!1);he(),c.useEffect(()=>{if(window.localStorage.getItem("token")!==null){let i={};i.name=window.localStorage.getItem("user.name"),i.id=window.localStorage.getItem("user.id"),i.loginAccountId=window.localStorage.getItem("user.loginAccountId"),i.email=window.localStorage.getItem("user.email");let s=window.localStorage.getItem("role");ue(s,i)}se.defaults.baseURL="https://apartment-server.wangminan.me",se.get("/api/auth/hello")},[]);const ie=[{title:"Name",dataIndex:"name",key:"name"},{title:"Position",dataIndex:"position",key:"position"},{title:"Location",dataIndex:"location",key:"location"},{title:"Action",key:"action",render:(i,s,a)=>e.jsxs(z,{size:"middle",children:[e.jsx(A,{type:"primary",onClick:()=>W(a,s,"apart"),children:"修改此条目"}),e.jsxs(A,{type:"primary",onClick:()=>ke(a),children:["删除",s.name]})]})}];function V(i){_(()=>{let s=[];for(let a=0;a<i.length-1;a++)s.push(i[a].dataIndex);return console.log(s),s}),_(s=>s)}function ve(i){K(()=>(F[i.target.id]=i.target.value,F))}function W(i,s,a){Se(()=>a),q(s),S(!0),G(()=>"修改第"+(i+1)+"条"),_(t=>(q(C=>(we(()=>{let l=[];for(let v=0;v<t.length;v++)l.push(e.jsxs("div",{children:[e.jsx("p",{children:t[v]}),e.jsx(D,{id:t[v],onChange:ve,defaultValue:C[t[v]]})]},Q())),K(P=>(P[t[v]]=C[t[v]],P));return l}),C)),t))}function Ce(i,s){let a=[];if(K(t=>(a=t.location.split(","),t)),a.length!=2){alert("Location格式不正确！");return}O(t=>(E({method:"PUT",url:`/api/management/apartment/${t[i]}`,data:{foremanAdminId:f,name:F.name,position:F.position,positionLongitude:a[1],positionLatitude:a[0],status:s.status}}).then(C=>{const{code:l}=C.data;if(l===2e3)Z(1,100),alert("修改已完成，请刷新以查看修改结果"),S(!1);else{const{msg:v}=C.data;alert(v),S(!1)}}),t))}function ke(i){E({method:"DELETE",url:`/api/management/apartment/${X[i]}`}).then(s=>{const{code:a}=s.data;if(a===2e3)Z(1,100);else{const{msg:t}=s.data;alert(t)}})}function Z(i,s){E({method:"GET",url:`/api/management/apartment?pageNum=${i}&pageSize=${s}`}).then(a=>{const{code:t,msg:C}=a.data,{list:l,total:v}=a.data.result;if(t===2e3){m("公寓列表"),h(Math.ceil(v/s)),y(ie),V(ie),O(r=>(r=[],r));let P=[];for(let r=0;r<l.length;r++){O(L=>(L.push(l[r].id),L));let d={};d.key=Q(),d.index=r,d.name=l[r].name,d.position=l[r].position,d.location=l[r].location,P.push(d)}w(P),Y(()=>(B.publish("tablereturned",!0),!0))}else alert(C)})}const le=[{title:"宿舍号",dataIndex:"name",key:"name"},{title:"性别",dataIndex:"sex",key:"sex"},{title:"用途",dataIndex:"usage",key:"usage"},{title:"房间规格",dataIndex:"type",key:"type"},{title:"干部房",dataIndex:"isForCadre",key:"isForCadre"},{title:"保留间",dataIndex:"isReserved",key:"isReserved"},{title:"房间总价",dataIndex:"totalFee",key:"totalFee"},{title:"自理部分",dataIndex:"selfPayFee",key:"selfPayFee"},{title:"单位报销",dataIndex:"refundFee",key:"refundFee"},{title:"Action",key:"action",render:(i,s,a)=>e.jsxs(z,{size:"middle",children:[e.jsx(A,{type:"primary",onClick:()=>W(a,s,"room"),children:"修改此条目"}),e.jsxs(A,{type:"primary",onClick:()=>Ue(a),children:["删除",s.name]})]})}];function Re(i,s){let a=!0;K(t=>(t.sex==="man"||t.sex==="男"?t.sex=0:t.sex==="woman"||t.sex==="女"?t.sex=1:(alert("性别格式非法"),a=!1),t.isForCadre==="是"?t.isForCadre=1:t.isForCadre==="否"?t.isForCadre=0:(alert("干部房状态格式非法"),a=!1),t.isReserved==="是"?t.isReserved=1:t.isReserved==="否"?t.isReserved=0:(alert("保留间状态格式非法"),a=!1),t.type==="单人间"?t.type=1:t.type==="双人间"?t.type=2:t.type=parseInt(t.type.substring(0,t.type.indexOf("人"))),t.totalFee!==t.selfPayFee+t.refundFee&&(alert("总价不等于单位报销部分和个人自理部分之和"),a=!1),t)),a&&O(t=>(E({method:"PUT",url:`/api/management/room/${t[i]}`,data:{apartmentId:1,name:F.name,sex:F.sex,usage:F.usage,isForCadre:F.isForCadre,isReserved:F.isReserved,type:F.type,totalFee:F.totalFee,selfPayFee:F.selfPayFee,refundFee:F.refundFee}}).then(C=>{const{code:l}=C.data;if(l===2e3)ee(1,100),alert("修改已完成，请刷新以查看修改结果"),S(!1);else{const{msg:v}=C.data;alert(v),S(!1)}}),t))}function Ue(i){E({method:"DELETE",url:`/api/management/room/${X[i]}`}).then(s=>{const{code:a}=s.data;if(a===2e3)ee(1,100);else{const{msg:t}=s.data;alert(t)}})}function ee(i,s){E.get("/api/management/room",{params:{pageNum:i,pageSize:s,apartmentId:1,query:"",isForCadre:"",type:""}}).then(a=>{const{code:t,msg:C}=a.data,{list:l,total:v}=a.data.result;if(t===2e3){m("房间列表"),h(Math.ceil(v/s)),h(r=>(B.publish("tablepage",r),r)),y(le),V(le),O(r=>(r=[],r));let P=[];for(let r=0;r<l.length;r++){O(L=>(L.push(l[r].id),L));let d={};d.key=Q(),d.index=r,d.name=l[r].name,l[r].sex===0?d.sex="man":l[r].sex===1&&(d.sex="woman"),d.usage=l[r].usage,l[r].type===1?d.type="单人间":l[r].type===2?d.type="双人间":d.type=l[r].type+"人间",l[r].isForCadre?d.isForCadre="是":d.isForCadre="否",l[r].isReserved?d.isReserved="是":d.isReserved="否",d.totalFee=l[r].totalFee,d.selfPayFee=l[r].selfPayFee,d.refundFee=l[r].refundFee,P.push(d)}w(P),Y(()=>(B.publish("tablereturned",!0),!0))}else alert(C)})}const de=[{title:"床位名",dataIndex:"name",key:"name"},{title:"所属房间的id",dataIndex:"roomId",key:"roomId"},{title:"押金收据单号",dataIndex:"receiptId",key:"receiptId"},{title:"是否正在使用中",dataIndex:"isInUse",key:"isInUse"},{title:"Action",key:"action",render:(i,s,a)=>e.jsxs(z,{size:"middle",children:[e.jsx(A,{type:"primary",onClick:()=>W(a,s,"bed"),children:"修改此条目"}),e.jsxs(A,{type:"primary",onClick:()=>Fe(a),children:["删除",s.name]})]})}];function Fe(i){E({method:"DELETE",url:`/api/management/bed/${X[i]}`}).then(s=>{const{code:a}=s.data;if(a===2e3)ce(1,100);else{const{msg:t}=s.data;alert(t)}})}function ce(i,s){E.get("/api/management/bed",{params:{pageNum:i,pageSize:s,apartmentId:1,query:"",roomId:"",isInUse:""}}).then(a=>{const{code:t,msg:C}=a.data,{list:l,total:v}=a.data.result;if(t===2e3){m("床位列表"),h(Math.ceil(v/s)),h(r=>(B.publish("tablepage",r),r)),y(de),V(de),O(r=>(r=[],r));let P=[];for(let r=0;r<l.length;r++){O(L=>(L.push(l[r].id),L));let d={};d.key=Q(),d.index=r,d.name=l[r].name,d.roomId=l[r].roomId,d.receiptId=l[r].receiptId,d.isInUse=l[r].isInUse,P.push(d)}w(P),Y(()=>(B.publish("tablereturned",!0),!0))}else alert(C)})}function ue(i,s){g(()=>!0),x(i),u(s.name)}function Ae(){window.localStorage.removeItem("token"),g(!1)}return n?e.jsxs("div",{children:[e.jsx(Ye,{lognum:f,usermsg:o,textitem:We,columns:j,tabledata:k,tablepage:I,tabletitle:b,logOut:Ae,getApart:Z,getRoom:ee,getBed:ce}),e.jsx(Ve,{type:Ie,title:N,placement:"bottom",onClose:()=>S(!1),open:p,tableitems:be,records:$,apartUpdate:Ce,roomUpdate:Re})]}):e.jsx("div",{className:"login-box",children:e.jsx("div",{className:"glass",children:e.jsxs("div",{className:"innerlogin",children:[e.jsx("p",{children:"公寓员工管理系统"}),e.jsx("img",{src:Ge}),e.jsxs(je,{children:[e.jsx(T,{path:"/login",element:e.jsx(He,{login:ue})}),e.jsx(T,{path:"/register",element:e.jsx(Qe,{})}),e.jsx(T,{path:"*",element:e.jsx(ye,{to:"/login"})})]})]})})})}const ne="user_key",et={saveUser(n){te.set(ne,n)},getUser(){return te.get(ne)||{}},removeUser(){te.remove(ne)}};et.getUser();Pe.createRoot(document.getElementById("root")).render(e.jsx(Ee,{children:e.jsx(Ze,{})}));
