import{r as a,j as e,R as re}from"./react-2ce75adb.js";import{c as Ie}from"./react-dom-16e2f971.js";import{B as Ce}from"./react-router-dom-93ff5a9d.js";import{a as _}from"./axios-4a70c6fc.js";import{q as ke}from"./qs-88f287ae.js";import{J as Ae}from"./js-encrypt-af0330d8.js";import{I as L,T as le,B as A,M as Re,S as ce,a as F,b as Ue,L as ae,c as Oe,H as Ee,C as Le,D as oe,R as B}from"./antd-8ba4bffd.js";import{U as ue,r as Pe,s as $,i as V,t as v}from"./@ant-design-ed38ce50.js";import{u as de,a as me,b as O,N as pe}from"./react-router-e1c202a2.js";import{P as D}from"./pubsub-js-164616ad.js";import{v as J}from"./uuid-a960c1f4.js";import{s as X}from"./store-502a59ff.js";import"./call-bind-892c8155.js";import"./get-intrinsic-bd2830fd.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-f7d0b240.js";import"./function-bind-22e7ee79.js";import"./has-26d28e02.js";import"./scheduler-765c72db.js";import"./@remix-run-93d98c9a.js";import"./side-channel-b75e8576.js";import"./object-inspect-13342da8.js";import"./rc-util-6113d818.js";import"./@babel-5495bcd4.js";import"./react-is-e8e5dbb3.js";import"./classnames-776d2d10.js";import"./rc-resize-observer-a555e72e.js";import"./resize-observer-polyfill-0f9f8adb.js";import"./rc-motion-03bbea80.js";import"./rc-menu-c9d15123.js";import"./rc-overflow-9ca771c7.js";import"./@rc-component-a9ea3bc3.js";import"./rc-select-92a0ff80.js";import"./rc-virtual-list-defe1c81.js";import"./rc-drawer-651537b2.js";import"./rc-field-form-57489eb5.js";import"./async-validator-7f96df71.js";import"./rc-table-c1c02ffb.js";import"./rc-pagination-00abd4cf.js";import"./rc-picker-f2201c79.js";import"./@ctrl-fb5a5473.js";import"./throttle-debounce-87e7e444.js";import"./rc-checkbox-40fd5abe.js";import"./rc-dropdown-28db7cec.js";import"./rc-tooltip-97af0835.js";import"./rc-tree-4abb3b64.js";import"./rc-input-dbde50a4.js";import"./rc-textarea-47b9c3f4.js";import"./@emotion-c0b5c018.js";import"./stylis-fad5b415.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))m(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const f of i.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&m(f)}).observe(document,{childList:!0,subtree:!0});function p(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function m(s){if(s.ep)return;s.ep=!0;const i=p(s);fetch(s.href,i)}})();const U=_.create({baseURL:"https://apartment-server.wangminan.me",paramsSerializer:t=>ke.stringify(t,{arrayFormat:"brackets"})});U.interceptors.request.use(t=>(window.localStorage.getItem("token")!==void 0&&(t.headers.Authorization="Bearer "+window.localStorage.getItem("token")),t),t=>Promise.reject(t));U.interceptors.response.use(t=>(t!==null&&t.data!==null&&t.data.code!==null&&(t.data.code===4012||t.data.code===4010||t.data.code===4030)&&(window.localStorage.removeItem("token"),setTimeout(()=>{window.location.href="/login"},3e3)),t),t=>Promise.reject(t));const Te=`MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5vwYRBKySNSl/60qRqcD
lDVcNP9j2UyB7yalGI9MtlBEZ16pEiR08TuZjUL00go5LEb6z+ghVlp6UOsWR6i3
r7Q+FleKHG2yStqqaWx+11OQzOjffXQwqb1t/0bq/tzy04KBinSaB/yqnMc0yO8n
rZx8OtUX5rMcM7BjvpFOdnCSFUAOOfKRirfT5RydyGeLPOnBTwJIwpygGu20++UX
MxARO1aAJeUXeI+9g+XcsAi1EKbI2YdjWJ8PQnBC9+lsDRS3w8uKqUOZdYu/FxAy
bEjQ+YOXzfu2PB9+BdilkztV/yuF6hfk7MpGdA2JoBsJlljSYWH1mUE+e9mnUyHi
/wIDAQAB`;function Be(t){const d=new Ae;return d.setPublicKey(Te),d.encrypt(t)}function De(t){const d="13777864453",p="root",[m,s]=a.useState(d),[i,f]=a.useState(p),[w,b]=a.useState(!1);function j(g){s(()=>g.target.value)}function k(g){f(()=>g.target.value)}function S(){b(!0),U({method:"POST",url:"/api/auth/login/password",data:{username:m,password:Be(i)}}).then(g=>{const{code:l,result:h}=g.data;if(l===2e3)if(window.localStorage.setItem("token",h.token),window.localStorage.setItem("role",h.role),h.user)h.user,t.login(h.role,h.user);else{const C=h.admin;window.localStorage.setItem("user.id",C.id),window.localStorage.setItem("user.name",C.name),window.localStorage.setItem("user.loginAccountId",C.loginAccountId),window.localStorage.setItem("user.email",C.email),t.login(h.role,h.admin)}else{const{msg:C}=g.data;f(""),alert(C)}b(!1)})}return e.jsxs("div",{children:[e.jsx(L,{value:m,onChange:j,placeholder:"Enter your username",prefix:e.jsx(ue,{className:"site-form-item-icon"}),suffix:e.jsx(le,{title:"Extra information",children:e.jsx(Pe,{style:{color:"rgba(0,0,0,.45)"}})})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(L.Password,{value:i,onChange:k,placeholder:"input password",iconRender:g=>g?e.jsx($,{}):e.jsx(V,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(A,{size:"large",type:"primary",loading:w,onClick:S,children:"Login"})]})}function Ne(){const[t,d]=a.useState(""),[p,m]=a.useState(""),[s,i]=a.useState(""),[f,w]=a.useState("");function b(l){d(()=>l.target.value)}function j(l,h){w(h!==""&&l!==h?()=>"error":()=>"")}function k(l){m(()=>l.target.value),j(l.target.value,s)}function S(l){i(()=>l.target.value),j(p,l.target.value)}function g(l){p!==s&&alert("")}return e.jsxs("div",{children:[e.jsx(L,{onChange:b,placeholder:"default size",prefix:e.jsx(ue,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(L.Password,{onChange:k,placeholder:"input password",iconRender:l=>l?e.jsx($,{}):e.jsx(V,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(L.Password,{status:f,onChange:S,placeholder:"password again",iconRender:l=>l?e.jsx($,{}):e.jsx(V,{})}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(A,{size:"large",type:"primary",onClick:g,children:"SignUP"})]})}const Me=""+new URL("apartment-d819f74c.svg",import.meta.url).href;function ze(t){const{routers:d}=t,p=de();function m(s){p("/home"+d[parseInt(s.key,10)-1].route,{replace:!0})}return e.jsx("div",{children:e.jsx("div",{children:e.jsx(Re,{mode:t.mode,theme:t.theme,items:t.textitem,onClick:m})})})}function Fe(t){return e.jsx(le,{placement:"right",title:"先生/女士",children:e.jsxs("span",{children:["欢迎您，",t.job," ",t.usermsg]})})}function ie(t){const{getApart:d,getRoom:p}=t;let{tabletype:m,columns:s,tabledata:i,tablepage:f,tabletitle:w}=t;const[b,j]=a.useState(!1);D.subscribe("tablereturned",(g,l)=>{j(()=>l),console.log(b)});const[,k]=re.useState(),S=re.useCallback(()=>k({}),[]);return a.useEffect(()=>{m==="apart"?(j(!1),d(1,100),S()):m==="room"&&(j(!1),p(1,100),S())},[m]),b?(D.subscribe("tablepage",(g,l)=>{f=l,console.log(f)}),e.jsx("div",{children:e.jsxs(F,{direction:"vertical",size:16,children:[e.jsx("h2",{children:w}),e.jsx(A,{children:"增加"}),e.jsx(Ue,{columns:s,dataSource:i,pagination:!1})]})})):e.jsx("div",{children:e.jsx(ce,{})})}const qe={textAlign:"center",minHeight:120,lineHeight:"120px",color:"#000",backgroundColor:"#eee"},Ke={textAlign:"center",lineHeight:"120px"};function He(t){const{logOut:d}=t,{getApart:p,getRoom:m}=t,{lognum:s,textitem:i,usermsg:f,columns:w,tabledata:b,tablepage:j,tabletitle:k}=t,S=i[s].routers,[g,l]=a.useState(!1);function h(){d()}return e.jsx(F,{direction:"vertical",style:{width:"100%"},size:[0,48],children:e.jsxs(ae,{style:{minHeight:"100vh"},children:[e.jsx(Oe,{style:Ke,collapsible:!0,collapsed:g,onCollapse:C=>l(C),children:e.jsx(ze,{mode:"inline",theme:"dark",textitem:i[s].item,routers:S})}),e.jsxs(ae,{children:[e.jsx(Ee,{children:e.jsx(A,{onClick:h,children:"LogOut"})}),e.jsx(Le,{style:qe,children:e.jsxs(me,{children:[e.jsx(O,{path:"/home/welcome",element:e.jsx(Fe,{job:i[s].name,usermsg:f})}),e.jsx(O,{path:"/home/apart",element:e.jsx(ie,{getApart:p,tabletype:"apart",columns:w,tabledata:b,tablepage:j,tabletitle:k})}),e.jsx(O,{path:"/home/room",element:e.jsx(ie,{getRoom:m,tabletype:"room",columns:w,tabledata:b,tablepage:j,tabletitle:k})}),e.jsx(O,{path:"*",element:e.jsx(pe,{to:"/home/welcome"})})]})})]})]})})}function Qe(t){const{title:d,placement:p,onClose:m,open:s,tableitems:i,records:f,apartUpdate:w}=t,[b,j]=a.useState(!1),[k,S]=a.useState(0),[g,l]=a.useState({status:0});function h(){j(!0),w(f.key-1,g),j(!1)}function C(N){l(()=>(g.status=N.target.value,g)),S(N.target.value)}return i.length===0?e.jsx(oe,{title:d,placement:p,onClose:m,open:s,children:e.jsx(ce,{})}):e.jsxs(oe,{title:d,placement:p,onClose:m,open:s,children:[i,"此公寓",e.jsxs(B.Group,{onChange:C,value:k,children:[e.jsx(B,{value:0,children:"正常使用"}),e.jsx(B,{value:1,children:"启用中"}),e.jsx(B,{value:2,children:"弃用中"}),e.jsx(B,{value:3,children:"已弃用"})]}),e.jsx("br",{}),e.jsx("div",{style:{textAlign:"center"},children:e.jsx(A,{type:"primary",loading:b,onClick:h,children:"修改"})})]})}function I(t,d,p,m,s){return{key:d,icon:p,children:m,label:t,type:s}}const Ge=[{},{id:1,name:"超级管理员",item:[I("管理员账号管理","1",e.jsx(v,{})),I("外部单位管理","2",e.jsx(v,{})),I("公寓管理","3",e.jsx(v,{})),I("房间管理","4",e.jsx(v,{}))]},{id:2,name:"入住办理员",item:[I("入住申请审核","1",e.jsx(v,{})),I("床位编号录入","2",e.jsx(v,{})),I("人脸录入确认","3",e.jsx(v,{}))]},{id:3,name:"宿舍调配员",item:[I("住/调宿申请","1",e.jsx(v,{})),I("公寓管理","2",e.jsx(v,{})),I("房间管理","3",e.jsx(v,{})),I("床位管理","4",e.jsx(v,{}))],routers:[{route:"/promise"},{route:"/apart"},{route:"/room"},{route:"/bed"}]},{id:4,name:"财务人员",item:[I("缴费统计表","1",e.jsx(v,{})),I("催收信","2",e.jsx(v,{})),I("宿舍情况查询","3",e.jsx(v,{}))]}];function Je(){const[t,d]=a.useState(!1),[p,m]=a.useState(0),[s,i]=a.useState(null),[f,w]=a.useState([]),[b,j]=a.useState([]),[k,S]=a.useState(0),[g,l]=a.useState(""),[h,C]=a.useState(!1),[N,ge]=a.useState(""),[xe,W]=a.useState({}),[Ye,q]=a.useState([]),[he,fe]=a.useState([]),[M,K]=a.useState({}),[H,z]=a.useState([]),[_e,Z]=a.useState(!1);de(),a.useEffect(()=>{if(window.localStorage.getItem("token")!==null){let c={};c.name=window.localStorage.getItem("user.name"),c.id=window.localStorage.getItem("user.id"),c.loginAccountId=window.localStorage.getItem("user.loginAccountId"),c.email=window.localStorage.getItem("user.email");let r=window.localStorage.getItem("role");ne(r,c)}_.defaults.baseURL="https://apartment-server.wangminan.me",_.get("/api/auth/hello")},[]);const Q=[{title:"Name",dataIndex:"name",key:"name"},{title:"Position",dataIndex:"position",key:"position"},{title:"Location",dataIndex:"location",key:"location"},{title:"Action",key:"action",render:(c,r,n)=>e.jsxs(F,{size:"middle",children:[e.jsx(A,{type:"primary",onClick:()=>te(n,r),children:"修改此条目"}),e.jsxs(A,{type:"primary",onClick:()=>we(n),children:["删除",r.name]})]})}];function ee(c){q(()=>{let r=[];for(let n=0;n<c.length-1;n++)r.push(c[n].dataIndex);return r}),q(r=>r)}function je(c){K(()=>(M[c.target.id]=c.target.value,M))}function te(c,r){W(r),C(!0),ge(()=>"修改第"+(c+1)+"条"),q(n=>(W(y=>(fe(()=>{let R=[];for(let u=0;u<n.length;u++)R.push(e.jsxs("div",{children:[e.jsx("p",{children:n[u]}),e.jsx(L,{id:n[u],onChange:je,defaultValue:y[n[u]]})]},J())),K(E=>(E[n[u]]=y[n[u]],E));return R}),y)),n))}function ye(c,r){let n=[];if(K(y=>(n=y.location.split(","),y)),n.length!=2){alert("Location格式不正确！");return}U({method:"PUT",url:`/api/management/apartment/${H[c]}`,data:{foremanAdminId:p,name:M.name,position:M.position,positionLongitude:n[1],positionLatitude:n[0],status:r.status}}).then(y=>{const{code:R}=y.data;if(R===2e3)G(1,100),alert("修改已完成");else{const{msg:u}=y.data;alert(u)}})}function we(c){U({method:"DELETE",url:`/api/management/apartment/${H[c]}`}).then(r=>{const{code:n}=r.data;if(n===2e3)G(1,100);else{const{msg:y}=r.data;alert(y)}})}function G(c,r){U({method:"GET",url:`/api/management/apartment?pageNum=${c}&pageSize=${r}`}).then(n=>{const{code:y,msg:R}=n.data,{list:u,total:E}=n.data.result;if(y===2e3){l("公寓列表"),S(Math.ceil(E/r)),w(Q),ee(Q),z(o=>(o=[],o));let P=[];for(let o=0;o<u.length;o++){z(T=>(T.push(u[o].id),T));let x={};x.key=J(),x.name=u[o].name,x.position=u[o].position,x.location=u[o].location,P.push(x)}j(P),Z(()=>(D.publish("tablereturned",!0),!0))}else alert(R)})}const be=[{title:"宿舍号",dataIndex:"name",key:"name"},{title:"性别",dataIndex:"sex",key:"sex"},{title:"用途",dataIndex:"usage",key:"usage"},{title:"房间规格",dataIndex:"type",key:"type"},{title:"干部房",dataIndex:"isForCadre",key:"isForCadre"},{title:"保留间",dataIndex:"isReserved",key:"isReserved"},{title:"Action",key:"action",render:(c,r,n)=>e.jsxs(F,{size:"middle",children:[e.jsx(A,{type:"primary",onClick:()=>te(n,r),children:"修改此条目"}),e.jsxs(A,{type:"primary",onClick:()=>Se(n),children:["删除",r.name]})]})}];function Se(c){U({method:"DELETE",url:`/api/management/room/${H[c]}`}).then(r=>{const{code:n}=r.data;if(n===2e3)se(1,100);else{const{msg:y}=r.data;alert(y)}})}function se(c,r){U.get("/api/management/room",{params:{pageNum:c,pageSize:r,apartmentId:1,query:"",isForCadre:"",type:""}}).then(n=>{const{code:y,msg:R}=n.data,{list:u,total:E}=n.data.result;if(y===2e3){l("房间列表"),S(Math.ceil(E/r)),S(o=>(D.publish("tablepage",o),o)),w(be),ee(Q),z(o=>(o=[],o));let P=[];for(let o=0;o<u.length;o++){z(T=>(T.push(u[o].id),T));let x={};x.key=J(),x.name=u[o].name,u[o].sex===0?x.sex="man":u[o].sex===1&&(x.sex="woman"),x.usage=u[o].usage,u[o].type===1?x.type="单人间":u[o].type===2?x.type="双人间":x.type=u[o].type+"人间",u[o].isForCadre?x.isForCadre="是":x.isForCadre="否",u[o].isReserved?x.isReserved="是":x.isReserved="否",P.push(x)}j(P),Z(()=>(D.publish("tablereturned",!0),!0))}else alert(R)})}function ne(c,r){d(()=>!0),m(c),i(r.name)}function ve(){window.localStorage.removeItem("token"),d(!1)}return t?e.jsxs("div",{children:[e.jsx(He,{lognum:p,usermsg:s,textitem:Ge,columns:f,tabledata:b,tablepage:k,tabletitle:g,logOut:ve,getApart:G,getRoom:se}),e.jsx(Qe,{title:N,placement:"bottom",onClose:()=>C(!1),open:h,tableitems:he,records:xe,apartUpdate:ye})]}):e.jsx("div",{className:"login-box",children:e.jsx("div",{className:"glass",children:e.jsxs("div",{className:"innerlogin",children:[e.jsx("p",{children:"公寓员工管理系统"}),e.jsx("img",{src:Me}),e.jsxs(me,{children:[e.jsx(O,{path:"/login",element:e.jsx(De,{login:ne})}),e.jsx(O,{path:"/register",element:e.jsx(Ne,{})}),e.jsx(O,{path:"*",element:e.jsx(pe,{to:"/login"})})]})]})})})}const Y="user_key",Xe={saveUser(t){X.set(Y,t)},getUser(){return X.get(Y)||{}},removeUser(){X.remove(Y)}};Xe.getUser();Ie.createRoot(document.getElementById("root")).render(e.jsx(Ce,{children:e.jsx(Je,{})}));
